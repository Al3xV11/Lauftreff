<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mittwoch Umfrage</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; max-width: 600px; margin: auto; }
button { display: block; width: 100%; margin: 6px 0; padding: 10px; font-size: 16px; }
</style>
</head>

<body>

<h2>ğŸ“ ZweibrÃ¼cken<br>ğŸ•“ Mittwoch, 16â€“18 Uhr</h2>
<p id="weather">Wetter wird geladenâ€¦</p>

<h3>So Leute, wer ist am Mittwoch am Start?</h3>

<input id="name" placeholder="Dein Name" style="width:100%;padding:8px">

<button onclick="vote('Laufen & Essen ğŸƒğŸƒâ€â™€ï¸ğŸ»')">ğŸƒğŸƒâ€â™€ï¸ğŸ» Laufen und essen</button>
<button onclick="vote('Nur Laufen ğŸƒğŸƒâ€â™€ï¸')">ğŸƒğŸƒâ€â™€ï¸ nur laufen</button>
<button onclick="vote('Nur Essen ğŸ»')">ğŸ» nur essen</button>
<button onclick="vote('Ganz raus ğŸ›')">ğŸ› ganz raus</button>

<h3>ğŸ‘‡ Aktuelle Stimmen</h3>
<ul id="results"></ul>

<script>
/* ğŸ”¥ Firebase */
firebase.initializeApp({
  apiKey: "DEIN_FIREBASE_KEY",
  authDomain: "lauftreff-ad4df.firebaseapp.com",
  projectId: "CrnOBsa4EhuncEqM6sf9"
});
const db = firebase.firestore();

/* ğŸ—³ï¸ Abstimmen (Name = Dokument â†’ Ã¼berschreibt alte Stimme) */
function vote(choice) {
  const name = document.getElementById("name").value.trim();
  if (!name) return alert("Name fehlt!");
  db.collection("votes").doc(name).set({
    choice: choice,
    time: new Date()
  });
}

/* ğŸ“Š Live-Ergebnisse */
db.collection("votes").onSnapshot(snap => {
  const ul = document.getElementById("results");
  ul.innerHTML = "";
  snap.forEach(doc => {
    ul.innerHTML += `<li>${doc.id} â†’ ${doc.data().choice}</li>`;
  });
});

/* ğŸŒ¦ï¸ Wetter fÃ¼r Mittwoch 16â€“18 Uhr */
async function loadWeather() {
  const key = "d5c77bf99195c16c75fc8a78261769ff";
  const lat = 49.2478, lon = 7.3666;

  const r = await fetch(
    `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=de&appid=${key}`
  );
  const data = await r.json();

  let temps = [], rain = false;
  data.list.forEach(e => {
    const d = new Date(e.dt * 1000);
    if (d.getDay() === 3 && d.getHours() >= 16 && d.getHours() <= 18) {
      temps.push(e.main.temp);
      if (e.rain) rain = true;
    }
  });

  const avg = (temps.reduce((a,b)=>a+b,0)/temps.length).toFixed(1);
  document.getElementById("weather").innerText =
    `ğŸŒ¦ï¸ ${avg} Â°C Â· Regen: ${rain ? "Ja" : "Nein"}`;
}
loadWeather();
</script>

</body>
</html>
